# Dbal Bundle for Symfony

**Dbal Bundle** ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å –¥–ª—è Symfony-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö (highload) —Å–∏—Å—Ç–µ–º, –≥–¥–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ Doctrine ORM —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —É–∑–∫–∏–º –º–µ—Å—Ç–æ–º. –ë–∞–Ω–¥–ª –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è –ø—Ä—è–º–æ–π, —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ Doctrine DBAL.

---

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- –í—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —É—Ä–æ–≤–Ω–µ DBAL.
- –ü—Ä—è–º–∞—è —Ä–∞–±–æ—Ç–∞ —Å DTO –∏ –º–∞—Å—Å–∏–≤–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö, –±–µ–∑ —Å–ª–æ—è ORM.
- –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ bulk-–æ–ø–µ—Ä–∞—Ü–∏–∏: insert, update, upsert, delete.
- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è cursor-based –∏ offset-based –∏—Ç–µ—Ä–∞—Ç–æ—Ä–æ–≤.
- –ë–∞–∑–æ–≤—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã Finder/Mutator –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∫ –ë–î.
- –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ SQL-–∑–∞–ø—Ä–æ—Å–∞–º–∏.
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–ª–µ—é—É—â–∏—Ö ORM:
    - MySQL 8

---

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

Dbal Bundle –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞—Ö –∏ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –∏ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥ –ª—é–±—ã–µ –Ω—É–∂–¥—ã.

### –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:

#### Finder/Mutator

- `DbalFinderInterface`: —á—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö, –¥–æ—Å—Ç—É–ø–µ–Ω –º–∞–ø–ø–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ DTO.
- `DbalMutatorInterface`: –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ, –≤—Å—Ç–∞–≤–∫–∞, –µ—Å—Ç—å —á–∏—Å—Ç—ã–π –º–µ—Ç–µ–æ–¥ execute.

#### Bulk-–æ–ø–µ—Ä–∞—Ü–∏–∏

- `BulkInserterInterface`: –í—Å—Ç–∞–≤–∫–∞ –æ–¥–Ω–æ–π –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç—Ä–æ–∫ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
- `BulkUpdaterInterface`: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–∂–Ω–æ–π\–º–Ω–æ–∂—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫ –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
- `BulkUpserterInterface`: –ö–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–ª–∏ –≤—Å—Ç–∞–≤–∫–∏ —Å—Ç—Ä–æ–∫ (upsert) –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö.
- `BulkDeleterInterface`: –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç—Ä–æ–∫ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö, –≤–∫–ª—é—á–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫—É soft delete.

#### –ò—Ç–µ—Ä–∞—Ç–æ—Ä—ã

- `CursorIteratorInterface`: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ cursor-based —á—Ç–µ–Ω–∏—è, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏.
- `OffsetIteratorInterface`: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø–æ—Å—Ç—Ä–∞–Ω–∏—á–Ω–∞—è –∏—Ç–µ—Ä–∞—Ü–∏—è.

#### –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã

- `DtoFieldExtractor`: –∏–∑–≤–ª–µ–∫–∞–µ—Ç –∏ –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª—è –∏–∑ DTO.
- `DbalTypeGuesser`: –º–∞–ø–ø–∏–Ω–≥ PHP-—Ç–∏–ø–æ–≤ –≤ SQL-—Ç–∏–ø—ã.
- `MysqlSqlBuilder`: –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –ø–æ–¥ MySQL.

---

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
composer require itech/dbal-bundle
```

–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –±–∞–Ω–¥–ª –≤ `config/bundles.php`:

```php
Your\Namespace\DbalBundle::class => ['all' => true],
```

---

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. DTO –∏ Bulk Insert

```php
/** @var BulkInserterInterface $inserter */
$inserter->insert('user_table', [
    ['uuid-1', 'email1@example.com'],
    ['uuid-2', 'email2@example.com'],
]);
```

### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

```php
/** @var BulkUpdaterInterface $updater */
$updater->update('user_table', [
    ['uuid-1', 'new-email@example.com']
]);
```

### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Finder

```php
/** @var DbalFinderInterface $finder */
$users = $finder->find('user_table', ['status' => 'active']);
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞

```php
$cursor = $finder->cursor('user_table', ['status' => 'active']);
foreach ($cursor as $row) {
    // –æ–±—Ä–∞–±–æ—Ç–∫–∞
}
```

## üìå –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

- PHP 8.2+
- Symfony 7.0+
- Doctrine DBAL 3.6+
- MySQL 8 / PostgreSQL –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —á–∞—Å—Ç–∏—á–Ω–æ (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)

---